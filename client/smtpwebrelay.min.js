if(void 0===global)var global=window;function isEncryptedData(e){return e.startsWith("##")&&16==e.indexOf("%")}function processError(e,o){if("function"!=typeof e)throw o;e(o,void 0)}global.sendMail=function({from:e,to:o,text:t,html:n,cc:r,bcc:s,subject:i,onebyone:a=!1,transport:d,callback:c,endpoint:p="https://smtpwebrelay.2812.fr/send",consoleLog:f=!1}){if(!c)return new Promise((a,c)=>{global.sendMail({from:e,to:o,text:t,html:n,cc:r,bcc:s,subject:i,transport:d,callback:(e,o)=>e?c(e):a(o),promise:!1,consoleLog:f,endpoint:p})});var l=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;if(!e||!isEncryptedData(e)&&!l.test(e))return processError(new Error('The address in the field "from" is missing or is not a valid email address.'));if(!o||!isEncryptedData(o)&&!l.test(o))return processError(new Error('The address in the field "to" is missing or is not a valid email address.'));var u="from="+encodeURIComponent(e)+"&to="+encodeURIComponent(o);if(i&&(u+="&subject="+encodeURIComponent(i)),t&&(u+="&text="+encodeURIComponent(t)),n&&(u+="&html="+encodeURIComponent(n)),!d){m=new Error("No transport provided, you must provide a SMTP server connection, encrypted or not.");if("function"==typeof c)return void c(m,void 0);throw m}if("object"==typeof d)u+="&transport="+encodeURIComponent(JSON.stringify(d));else{if("string"!=typeof d||"#"!=d[0]||"#"!=d[0]){var m=new Error("No identification provided, you must provide an SMTP string, encrypted or not.");if("function"==typeof c)return void c(m,void 0);throw m}u+="&transport="+encodeURIComponent(d)}var v=new XMLHttpRequest;if("withCredentials"in v)v.open("POST",p);else{if("undefined"==typeof XDomainRequest){m=new Error('Cannot send AJAX request, browser does not seem to support "XMLHttpRequest" or "XDomainRequest"');if("function"==typeof c)return void c(m,void 0);throw m}(v=new XDomainRequest).open("POST",p)}v.setRequestHeader("Content-type","application/x-www-form-urlencoded"),v.onreadystatechange=function(){this.readyState===XMLHttpRequest.DONE&&200===this.status&&(f&&console.log("Email sent to "+o),c&&c(void 0,v.responseText))},console.log("request params",u),v.send(u)};
